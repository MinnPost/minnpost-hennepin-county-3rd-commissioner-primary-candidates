/*! minnpost-hennepin-county-3rd-commissioner-primary-candidates - v0.0.0 - 2014-04-28
* https://github.com/minnpost/minnpost-hennepin-county-3rd-commissioner-primary-candidates
* Copyright (c) 2014 MinnPost; Licensed MIT */

define("helpers",["jquery","underscore","backbone"],function(a,b,c){var d={};return c.ajax=function(){var a=arguments;return a[0].dataTypeForce!==!0&&(a[0].dataType="jsonp",a[0].jsonpCallback="mpServerSideCachingHelper"+b.hash(a[0].url)),c.$.ajax.apply(c.$,a)},d.isMSIE=function(){var a=/(msie) ([\w.]+)/i.exec(navigator.userAgent);return a?parseInt(a[2],10):!1},d.jsonpRequest=function(c,d){return options.dataType="jsonp",options.jsonpCallback="mpServerSideCachingHelper"+b.hash(options.url),d.remoteProxy&&(options.url=options.url+"&callback=mpServerSideCachingHelper",options.url=d.remoteProxy+encodeURIComponent(options.url),options.cache=!0),a.ajax.apply(a,[options])},d.getLocalData=function(c,e){var f=!1,g=[];return c=b.isArray(c)?c:[c],e&&e.paths&&0===e.paths.data.indexOf("http")&&(f=!0),b.each(c,function(b){var c;c=f?d.jsonpRequest({url:proxyPrefix+encodeURI(e.paths.data+b)},e):a.getJSON(e.paths.data+b),g.push(c)}),a.when.apply(a,g)},d.parseQueryString=function(){var a={},c=function(a){return decodeURIComponent(a.replace(/\+/g," "))},d=location.search.substring(1),e=d.split("&");return b.each(e,function(b){var d=b.split("=");d.length>1&&(a[c(d[0])]=c(d[1]))}),a},d}),define("models",["underscore","backbone"],function(a,b){var c={};return c.Base=b.Model.extend({initialize:function(a,b){this.options=b||{},this.app=b.app}}),c.Question=c.Base.extend({idAttribute:"questionid",makeUnanswerable:function(){var a=this.get("state");this.set("state","answered"!==a||"answered"===a&&"S"===this.get("answer")?"unanswerable":a)}}),c.Candidate=c.Base.extend({idAttribute:"candidateid"}),c.Category=c.Base.extend({idAttribute:"categoryid"}),c}),define("collections",["underscore","backbone","models"],function(a,b,c){var d={};return d.Base=b.Collection.extend({initialize:function(a,b){this.options=b||{},this.app=b.app},setAll:function(a,b){this.each(function(c){c.set(a,b)})}}),d.Questions=d.Base.extend({model:c.Question}),d.Candidates=d.Base.extend({model:c.Candidate,comparator:"last"}),d.Categories=d.Base.extend({model:c.Category}),d}),define("text!templates/application.mustache",[],function(){return'<div class="application-container">\n  <div class="message-container"></div>\n\n  <div class="content-container">\n\n    <div class="navigation horizontal top-container">\n      <div class="candidate-list">\n        {{#candidates}}\n          <div class="candidate {{#eliminated}}eliminated{{/eliminated}} inline-block">\n            <img class="rounded" src="{{ options.paths.images }}{{ candidateid }}.jpg">\n            <div class="candidate-name small">\n              {{#profileurl}}\n                <a href="{{ profileurl }}" target="_blank">{{ name }}</a>\n              {{/profileurl}}\n              {{^profileurl}}{{ name }}{{/profileurl}}\n            </div>\n          </div>\n        {{/candidates}}\n      </div>\n\n      <div class="one-left">\n        {{#(candidatesLeft.length === 1)}}\n          {{#candidatesLeft.0}}\n            It looks like <strong>{{ name }}</strong> is your best fit.\n              {{#profileurl}}\n                <a href="{{ profileurl }}" target="_blank">Learn more</a> about this candidate.\n              {{/profileurl}}\n              <a href="#" on-tap="clearQuestions" class="">Start over</a>.\n            {{/candidatesLeft.0}}\n        {{/()}}\n        {{#(typeof candidatesLeft.length != \'undefined\' && candidatesLeft.length === 0)}}\n          Somehow you filtered everyone out!  <a href="#" on-tap="clearQuestions" class="">Start over</a>.\n        {{/()}}\n      </div>\n    </div>\n\n    <div class="spacer"></div>\n\n    <div class="category-list hide">\n      {{#categories}}\n        <button class="button xsmall category">\n          {{ category }}\n        </button>\n      {{/categories}}\n    </div>\n\n    <p class="instructions caption">Answer the questions below to filter out candidates.  If a question goes dim, then that means answering it or changing that answer would not help filter more candidates, or it would lead to all candidates being filtered out.  If you want to start over, use this link to <a href="#" on-tap="clearQuestions" class="">clear all the answers</a>.</p>\n\n\n    <div class="question-list">\n      {{#questions}}\n        <div class="question {{ state }}">\n          <div class="question-text large">{{ question }}</div>\n\n          <div class="question-options">\n            <button\n              on-tap="answer:[\'Y\', {{ questionid }}]"\n              class="button small\n                {{#(answer !== \'Y\')}}info{{/()}}\n                {{#(answer === \'Y\')}}active primary{{/()}}"\n            >Yes</button>\n\n            <button\n              on-tap="answer:[\'N\', {{ questionid }}]"\n              class="button small\n                {{#(answer !== \'N\')}}info{{/()}}\n                {{#(answer === \'N\')}}active primary{{/()}}"\n            >No</button>\n\n            <button\n              on-tap="answer:[\'S\', {{ questionid }}]"\n              class="button small\n                {{#(answer !== \'S\')}}button-link{{/()}}\n                {{#(answer === \'S\')}}active primary{{/()}}"\n            >Skip</button>\n\n          </div>\n        </div>\n      {{/questions}}\n    </div>\n\n\n\n  </div>\n\n  <div class="footnote-container">\n    <div class="footnote">\n      <p>Some code, techniques, and data on <a href="https://github.com/minnpost/minnpost-hennepin-county-3rd-commissioner-primary-candidates" target="_blank">Github</a>.</p>\n    </div>\n  </div>\n</div>\n'}),define("text!templates/loading.mustache",[],function(){return'<div class="loading-container">\n  <div class="loading"><span>Loading...</span></div>\n</div>'}),define("views",["jquery","underscore","ractive","ractive-backbone","ractive-events-tap","helpers","text!templates/application.mustache","text!templates/loading.mustache"],function(a,b,c,d,e,f,g,h){var i={};return i.Base=c.extend({baseInit:function(a){this.app=a.app},adapt:["Backbone"]}),i.Application=i.Base.extend({template:g,partials:{loading:h},init:function(){var c=this;this.baseInit.apply(this,arguments),this.observe("candidates",function(d){if(!b.isUndefined(d)&&!c.stuck){var e=f.isMSIE()<=8?1200:500;b.delay(function(){a(c.el).find(".top-container").mpStick({})},e),c.stuck=!0}},{defer:!0})}}),i}),define("text!../data/preferences.json",[],function(){return'{"Candidate guide to Hennepin County 3rd Commissioner Primary":{"Questions":[{"category":"Partisanship","question":"Do you want a candidate who sought DFL endorsement?","eliminatesony":"carney, reuer","eliminatesonn":"greene, mavity, kelash, schweigert","unknownstance":"","na":"","rowNumber":1},{"category":"Endorsements","question":"Do you want a candidate endorsed by the GOP?","eliminatesony":"greene, mavity, kelash, schweigert, reuer","eliminatesonn":"carney","unknownstance":"","na":"","rowNumber":2},{"category":"Endorsements","question":"Do you want a candidate endorsed by the entire St. Louis Park City Council, State Rep. Ryan Winkler and State Sen. Ron Latz?","eliminatesony":"greene, carney, reuer, kelash, schweigert","eliminatesonn":"mavity","unknownstance":"","na":"","rowNumber":3},{"category":"Endorsements","question":"Do you want a candidate endorsed by Stonewall DFL, Hennepin Commissioner Higgins, State Rep. Hornstein, Minneapolis school board members Mammen, Monserrate & Gagnon?","eliminatesony":"mavity, carney, reuer, kelash, schweigert","eliminatesonn":"greene","unknownstance":"","na":"","rowNumber":4},{"category":"Endorsements","question":"Do you want a candidate endorsed by former NRP director Bob Miller, State Rep. Joe Mullery and Minneapolis Parks Commissioner Jon Olson? ","eliminatesony":"mavity, carney, reuer, schweigert, greene","eliminatesonn":"kelash","unknownstance":"","na":"","rowNumber":5},{"category":"Endorsements","question":"Do you want a candidate endorsed by County Attoney Mike Freeman and State Reps. Karen Clark & Susan Allen?","eliminatesony":"mavity, greene, carney, reuer, kelash","eliminatesonn":"schweigert","unknownstance":"","na":"","rowNumber":6},{"category":"Union support","question":"Do you want a candidate with union support?","eliminatesony":"greene, carney, reuer","eliminatesonn":"mavity, kelash, schweigert","unknownstance":"","na":"","rowNumber":7},{"category":"Union support","question":"Do you want a candidate supported by AFSCME, Teamsters, and Hennepin County Sheriffâ€™s Deputies?","eliminatesony":"mavity, greene, carney, reuer, kelash","eliminatesonn":"schweigert","unknownstance":"","na":"","rowNumber":8},{"category":"Union support","question":"Do you want a candidate supported by the Carpenters, Building Trades, Laborers, and Locomotive Workers?","eliminatesony":"mavity, greene, carney, reuer, schweigert","eliminatesonn":"kelash","unknownstance":"","na":"","rowNumber":9},{"category":"Union support","question":"Do you want a candidate supported by the Sheet Metal Workers?","eliminatesony":"greene, carney, reuer, kelash, schweigert","eliminatesonn":"mavity","unknownstance":"","na":"","rowNumber":10},{"category":"Elected experience","question":"Do you want a candidate with previous elected experience?","eliminatesony":"carney, reuer, schweigert","eliminatesonn":"greene, kelash, mavity","unknownstance":"","na":"","rowNumber":11},{"category":"Southwest LRT","question":"Do you want a candidate who would replace Southwest LRT with busways?","eliminatesony":"greene, mavity, kelash, schweigert, reuer","eliminatesonn":"carney","unknownstance":"","na":"","rowNumber":12},{"category":"Residence","question":"Do you want a candidate who lives in Minneapolis?","eliminatesony":"mavity","eliminatesonn":"greene, carney, reuer, kelash, schweigert","unknownstance":"","na":"","rowNumber":13},{"category":"Residence","question":"Do you want a candidate who lives in St. Louis Park?","eliminatesony":"greene, carney, reuer, kelash, schweigert","eliminatesonn":"mavity","unknownstance":"","na":"","rowNumber":14},{"category":"Minneapolis mayoral election","question":"Do you want a candidate who endorsed Mark Andrew for 2013 Minneapolis mayor?","eliminatesony":"carney, reuer, schweigert, mavity","eliminatesonn":"greene, kelash","unknownstance":"","na":"","rowNumber":15},{"category":"Minneapolis mayoral election","question":"Do you want a candidate who voted Betsy Hodges first in the 2013 Minneapolis mayoral election?","eliminatesony":"mavity, greene, carney, reuer, kelash","eliminatesonn":"schweigert","unknownstance":"","na":"","rowNumber":16},{"category":"Minneapolis mayoral election","question":"Do you want a candidate who voted Cam Winton first in the 2013 Minneapolis mayoral election?","eliminatesony":"mavity, greene, carney, kelash, schweigert","eliminatesonn":"reuer","unknownstance":"","na":"","rowNumber":17},{"category":"Experience","question":"Do you want a candidate who served on the boards of OutFront Minnesota and Minnesotans United for All Families?","eliminatesony":"mavity, carney, reuer, kelash, schweigert","eliminatesonn":"greene","unknownstance":"","na":"","rowNumber":18},{"category":"Experience","question":"Do you want a candidate who served on the Hennepin County Workforce Board?","eliminatesony":"greene, carney, reuer, schweigert","eliminatesonn":"mavity, kelash","unknownstance":"","na":"","rowNumber":19},{"category":"Experience","question":"Do you want a candidate who has worked as a Hennepin County prosecutor?","eliminatesony":"mavity, greene, carney, reuer, kelash","eliminatesonn":"schweigert","unknownstance":"","na":"","rowNumber":20}],"Candidates":[{"candidateid":"carney","name":"Bob Carney Jr.","last":"Carney","profileurl":"http://www.minnpost.com/community-voices/2014/04/hennepin-commissioner-candidate-demand-southwest-lrt-alternatives","rowNumber":1},{"candidateid":"reuer","name":"Bob Reuer","last":"Reuer","profileurl":"","rowNumber":2},{"candidateid":"greene","name":"Marion Greene","last":"Greene","profileurl":"http://www.minnpost.com/politics-policy/2014/04/hennepin-county-commissioner-election-interview-marion-greene","rowNumber":3},{"candidateid":"mavity","name":"Anne Mavity","last":"Mavity","profileurl":"http://www.minnpost.com/politics-policy/2014/04/hennepin-county-commissioner-election-interview-anne-mavity","rowNumber":4},{"candidateid":"kelash","name":"Ken Kelash","last":"Kelash","profileurl":"http://www.minnpost.com/politics-policy/2014/04/hennepin-county-commissioner-election-interview-ken-kelash","rowNumber":5},{"candidateid":"schweigert","name":"Ben Schweigert","last":"Schweigert","profileurl":"http://www.minnpost.com/politics-policy/2014/04/hennepin-county-commissioner-election-interview-ben-schweigert","rowNumber":6}]}}'}),define("minnpost-hennepin-county-3rd-commissioner-primary-candidates",["jquery","underscore","mpConfig","mpFormatters","mpNav","helpers","models","collections","views","text!../data/preferences.json"],function(a,b,c,d,e,f,g,h,i,j){var k=function(c){this.options=b.extend(this.defaultOptions,c),this.el=this.options.el,this.$el=a(this.el),this.$=function(a){return this.$el.find(a)},this.$content=this.$el.find(".content-container"),this.loadApp()};return b.extend(k.prototype,{start:function(){this.loadData(),this.applicationView=new i.Application({el:this.$el,data:{options:this.options,candidates:this.candidates,questions:this.questions,categories:this.categories},app:this}),this.handleEvents()},handleEvents:function(){var a=this;this.applicationView.on("answer",function(b,c){b.original.preventDefault();var d=c[0],e=c[1],f=a.questions.get(e);"unanswerable"!==f.get("state")&&f.set("answer",d)}),this.applicationView.on("clearQuestions",function(b){b.original.preventDefault(),a.questions.setAll("answer",null),a.questions.setAll("state","unanswered")}),this.questions.on("change:answer",function(b,c){b.set("state",null===c?"unanswered":"answered"),a.eliminateCandidates(),a.eliminateQuestions()}),this.candidates.on("change:eliminated",function(){a.applicationView.set("candidatesLeft",a.candidates.where({eliminated:!1}))})},eliminateQuestions:function(){var a=b.pluck(this.candidates.where({eliminated:!0}),"id"),c=b.pluck(this.candidates.where({eliminated:!1}),"id");this.questions.each(function(a){a.set("state","unanswerable"===a.get("state")?"unanswered":a.get("state"))}),this.questions.each(this.candidates.length-a.length<=1?function(a){a.makeUnanswerable()}:function(a){var d=b.difference(c,a.get("eliminatesony"));"answered"!==a.get("state")&&(b.isEmpty(d)||b.isEqual(d,c))&&a.makeUnanswerable()})},eliminateCandidates:function(){var a=this;this.candidates.setAll("eliminated",!1),this.questions.each(function(c){"Y"===c.get("answer")&&b.each(c.get("eliminatesony"),function(b){a.candidates.get(b).set("eliminated",!0)}),"N"===c.get("answer")&&b.each(c.get("eliminatesonn"),function(b){a.candidates.get(b).set("eliminated",!0)})})},loadData:function(){var c="Questions",e="Candidates";this.rawData=JSON.parse(j),this.rawData=this.rawData[b.keys(this.rawData)[0]],this.candidates=new h.Candidates(b.map(this.rawData[e],function(a){return a.eliminated=!1,a}),{app:this}),this.questions=new h.Questions(b.map(this.rawData[c],function(c){return c.eliminatesonn=b.filter(b.map(c.eliminatesonn.split(","),a.trim),function(a){return!!a}),c.eliminatesony=b.filter(b.map(c.eliminatesony.split(","),a.trim),function(a){return!!a}),c.unknownstance=b.filter(b.map(c.unknownstance.split(","),a.trim),function(a){return!!a}),c.categoryid=d.identifier(c.category),c.questionid=b.uniqueId("question-"),c.state="unanswered",c.answer=null,c}),{app:this}),this.categories=new h.Categories(this.questions.map(function(a){return a.pick("category","categoryid")}),{app:this})},defaultOptions:{projectName:"minnpost-hennepin-county-3rd-commissioner-primary-candidates",remoteProxy:null,el:".minnpost-hennepin-county-3rd-commissioner-primary-candidates-container",availablePaths:{local:{css:[".tmp/css/main.css"],images:"images/",data:"data/"},build:{css:["//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css","dist/minnpost-hennepin-county-3rd-commissioner-primary-candidates.libs.min.css","dist/minnpost-hennepin-county-3rd-commissioner-primary-candidates.latest.min.css"],ie:["dist/minnpost-hennepin-county-3rd-commissioner-primary-candidates.libs.min.ie.css","dist/minnpost-hennepin-county-3rd-commissioner-primary-candidates.latest.min.ie.css"],images:"dist/images/",data:"dist/data/"},deploy:{css:["//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css","https://s3.amazonaws.com/data.minnpost/projects/minnpost-hennepin-county-3rd-commissioner-primary-candidates/minnpost-hennepin-county-3rd-commissioner-primary-candidates.libs.min.css","https://s3.amazonaws.com/data.minnpost/projects/minnpost-hennepin-county-3rd-commissioner-primary-candidates/minnpost-hennepin-county-3rd-commissioner-primary-candidates.latest.min.css"],ie:["https://s3.amazonaws.com/data.minnpost/projects/minnpost-hennepin-county-3rd-commissioner-primary-candidates/minnpost-hennepin-county-3rd-commissioner-primary-candidates.libs.min.ie.css","https://s3.amazonaws.com/data.minnpost/projects/minnpost-hennepin-county-3rd-commissioner-primary-candidates/minnpost-hennepin-county-3rd-commissioner-primary-candidates.latest.min.ie.css"],images:"https://s3.amazonaws.com/data.minnpost/projects/minnpost-hennepin-county-3rd-commissioner-primary-candidates/images/",data:"https://s3.amazonaws.com/data.minnpost/projects/minnpost-hennepin-county-3rd-commissioner-primary-candidates/data/"}}},loadApp:function(){this.determinePaths(),this.getLocalAssests(function(a){this.renderAssests(a),this.start()})},determinePaths:function(){var a;this.options.deployment="deploy",-1!==window.location.host.indexOf("localhost")&&(this.options.deployment="local",a=f.parseQueryString(),b.isObject(a)&&b.isString(a.mpDeployment)&&(this.options.deployment=a.mpDeployment)),this.options.paths=this.options.availablePaths[this.options.deployment]},getLocalAssests:function(b){var c=this;"local"===this.options.deployment?a.getJSON("bower.json",function(a){b.apply(c,[a.dependencyMap])}):b.apply(this,[])},renderAssests:function(c){var d=f.isMSIE()&&f.isMSIE()<=8;b.isObject(c)&&b.each(c,function(c){c.css&&b.each(c.css,function(b){b=b.match(/^(http|\/\/)/)?b:"bower_components/"+b+".css",a("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />')}),c.ie&&d&&b.each(c.ie,function(b){b=b.match(/^(http|\/\/)/)?b:"bower_components/"+b+".css",a("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />')})}),b.each(this.options.paths.css,function(b){a("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />')}),d&&b.each(this.options.paths.ie,function(b){a("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />')}),this.$el.addClass("inline-processed")}}),k}),require(["jquery","minnpost-hennepin-county-3rd-commissioner-primary-candidates"],function(a,b){a(document).ready(function(){new b})});